{% load static %}
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Attendance Report</title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link
			href="https://fonts.googleapis.com/css2?family=Merriweather&family=Roboto&display=swap"
			rel="stylesheet"
		/>

		<style>
			body {
				font-family: "Roboto", sans-serif;
				font-size: 14px;
				background-color: #fff;
			}
			h1,
			h2,
			h3,
			h4,
			h5 {
				font-family: "Merriweather", serif;
			}
			header {
				border-bottom: 2px solid #000;
				margin-bottom: 1rem;
				padding-bottom: 0.5rem;
			}
			.header-title {
				font-size: 1.5rem;
				font-weight: bold;
				text-align: center;
			}
			.section-title {
				font-size: 1.1rem;
				margin-top: 2rem;
				margin-bottom: 0.5rem;
				font-weight: bold;
			}
			.input-group-text {
				width: 100px;
			}
			table {
				background-color: #fff;
				font-size: 12px;
			}
			tbody tr:nth-child(even) {
				background-color: #f2f2f2;
			}
			footer {
				border-top: 1px solid #ccc;
				margin-top: 2rem;
				padding-top: 0.5rem;
				font-size: 12px;
				text-align: center;
			}
			.badge-success {
				background-color: #28a745;
			}
			.badge-danger {
				background-color: #dc3545;
			}
			@media print {
				.input-group {
					border: none;
				}
				.input-group-text {
					font-weight: bold;
				}
				footer {
					position: fixed;
					bottom: 0;
					width: 100%;
				}
			}
		</style>
	</head>
	<body>
		<div
			class="container my-5 p-4 border rounded shadow-sm"
			style="
				max-width: 900px;
				font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			"
		>
			<!-- Header / Logo -->
			<div class="d-flex align-items-center mb-4 border-bottom pb-3">
				<div>
					<img
						src="{% static 'amsApp/dist/img/ams-logo.png' %}"
						class="brand-image img-circle elevation-3 mb-0"
						style="opacity: 0.8; width: 60px; height: 60px"
						alt="Logo"
					/>
				</div>
				<div>
					<h5 class="mb-0 fw-bold">USeP Attendance Monitoring System</h5>
					<small class="text-muted">Official Attendance Report</small>
				</div>
			</div>

			<!-- Report Info -->
			<div class="row mb-4">
				<div class="col-4">
					<strong>Date:</strong> <span id="dateInput"></span>
				</div>
				<div class="col-4">
					<strong>Event:</strong> <span id="eventInput"></span>
				</div>
				<div class="col-4">
					<strong>Office:</strong> <span id="officeInput"></span>
				</div>
			</div>

			<!-- Receipt-style separator -->
			<div class="text-center border-top border-bottom py-2 my-4">
				<strong class="text-uppercase">Attendance Breakdown</strong>
			</div>

			<!-- Present Table -->
			<div class="mb-5">
				<h6 class="bg-success text-white px-3 py-2 rounded-top">
					✔ Present(s)
				</h6>
				<table class="table table-bordered table-sm m-0">
					<thead class="table-light">
						<tr>
							<th style="width: 10%">#</th>
							<th>Employee</th>
							<th class="text-center">System Time</th>
							<th class="text-center">Punch In</th>
							<th class="text-center">Punch Out</th>
						</tr>
					</thead>
					<tbody id="presentLogs">
						{% if presents %} {% for log in presents %}
						<tr>
							<td>{{ log.punchNo }}</td>
							<td>{{ log.employee }}</td>
							<td class="text-center">{{ log.systemTime }}</td>
							<td class="text-center">
								{% if log.punchTimeIn == "00:00:00" %}--:--{% else %}{{
								log.punchTimeIn }}{% endif %}
							</td>
							<td class="text-center">
								{% if log.punchTimeOut == "00:00:00" %}--:--{% else %}{{
								log.punchTimeOut }}{% endif %}
							</td>
						</tr>
						{% endfor %} {% else %}
						<tr>
							<td colspan="5" class="text-center text-muted">
								No Present Logs...
							</td>
						</tr>
						{% endif %}
					</tbody>
				</table>
			</div>

			<!-- Absent Table -->
			<div class="mb-5">
				<h6 class="bg-danger text-white px-3 py-2 rounded-top">✘ Absent(s)</h6>
				<table class="table table-bordered table-sm m-0">
					<thead class="table-light">
						<tr>
							<th style="width: 10%">#</th>
							<th>Employee</th>
							<th class="text-center">System Time</th>
							<th class="text-center">Punch In</th>
							<th class="text-center">Punch Out</th>
						</tr>
					</thead>
					<tbody id="absentLogs">
						{% if absents %} {% for log in absents %}
						<tr>
							<td>{{ log.punchNo }}</td>
							<td>{{ log.employee }}</td>
							<td class="text-center">{{ log.systemTime }}</td>
							<td class="text-center">--:--</td>
							<td class="text-center">--:--</td>
						</tr>
						{% endfor %} {% else %}
						<tr>
							<td colspan="5" class="text-center text-muted">
								No Absent Logs...
							</td>
						</tr>
						{% endif %}
					</tbody>
				</table>
			</div>

			<!-- Signature and Timestamp -->
			<div class="row mt-5">
				<div class="col-6">
					<p class="mb-1"><strong>Prepared by:</strong></p>
					<div style="height: 50px; border-bottom: 1px solid #000"></div>
					<p class="small text-muted">Signature over printed name</p>
				</div>
				<div class="col-6 text-end">
					<p class="mb-1"><strong>Generated:</strong></p>
					<p id="generatedTime" class="text-muted small"></p>
				</div>
			</div>

			<!-- Footer -->
			<footer class="text-center mt-4 border-top pt-2">
				<p class="small text-muted mb-0">
					&copy; 2025 USeP - AMS. All rights reserved.
				</p>
			</footer>
		</div>

		<script>
			document.addEventListener("DOMContentLoaded", function () {
				const urlParams = new URLSearchParams(window.location.search);
				const encoded = urlParams.get("data");

				if (!encoded) return;

				const data = JSON.parse(atob(decodeURIComponent(encoded)));

				// Fill metadata
				document.querySelector("#dateInput").textContent = data.date;
				document.querySelector("#eventInput").textContent = data.event;
				document.querySelector("#officeInput").textContent = data.office;
				document.querySelector("#generatedTime").textContent =
					new Date().toLocaleString();

				// Fill tables
				function fillTable(logs, selector) {
					const tbody = document.querySelector(selector);
					tbody.innerHTML = "";

					if (!logs.length) {
						tbody.innerHTML = `<tr><td colspan="5" class="text-center text-muted">Nothing follows...</td></tr>`;
						return;
					}

					logs.forEach((log, idx) => {
						const row = document.createElement("tr");
						row.innerHTML = `
						<td class="text-center">${idx + 1}</td>
						<td>${log.employee}</td>
						<td class="text-center">${log.systemTime}</td>
						<td class="text-center">${log.punchTimeIn}</td>
						<td class="text-center">${log.punchTimeOut}</td>
					`;
						tbody.appendChild(row);
					});
				}

				fillTable(data.presents, "#presentLogs");
				fillTable(data.absents, "#absentLogs");
			});
		</script>
	</body>
</html>
